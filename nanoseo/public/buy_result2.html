<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" type="text/css" href="stylesheets/bootstrap.min.css" media='screen' />
  <link rel="stylesheet" type="text/css" href="stylesheets/bootstrap-slider.css" />
  <script src="javascripts/lib/jquery.min.js"></script>
  <script src="javascripts/util.js"></script>
  <script src="javascripts/prediction_buyer.js"></script>
  <script type="text/javascript" src="javascripts/lib/highcharts.js"></script>
  <script type="text/javascript" src="javascripts/lib/bootstrap-slider.js"></script>
  <script type="text/javascript" src="javascripts/lib/bootstrap.min.js"></script>
  <!-- <script src="javascripts/realtime.js"></script> -->
  <title>MARG BUY</title>

</head>
<body>
  <div class="jumbotron">
    <div class="container">
      <h1>에너지마켓</h1>
    </div>
  </div>
  <div class="container">
      <div class="row" align="center">
          <div class="col-lg-4">
              <h4 id="buyWatts"></h4>
              <h4 id="buyMessage"></h4>
              <h1 id="profitMessage"></h1>
          </div>
      </div>
  </div>
      <hr />
    <div class="container">
        <div class="row" align="center">
            <div class="col-lg-4">
              <h4 id="predictionValue"></h4>
              <h4 id="paidValue"></h4>
              <h1 id="buyProfit"></h1>
          </div>
        </div>
    </div>
    <script type="text/javascript">

        var urlParams;
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            console.log(url);
            url = url.toLowerCase(); // This is just to avoid case sensitiveness
            name = name.replace(/[\[\]]/g, "\\$&").toLowerCase();// This is just to avoid case sensitiveness for query parameter name
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        // console.log(stage);
        // console.log(thisMonth_prediction);
        window.updateComplete = function(stage, thisMonth_prediction, thisMonth_total){
          var cost = getParameterByName('cost');
          var originalCost = calcPrice(stage, thisMonth_prediction - (thisMonth_total.reduce(add, 0) * 0.3));
          function add(a, b) {
              return a + b;
          }
          var profits = originalCost - cost;

          $('#buyWatts').text(getParameterByName('quantity') + 'kW');
          $('#buyMessage').text(cost + '원 구매');
          $('#profitMessage').text(Math.round(profits) + '원 이득');
          $('#predictionValue').text('예상부담금액' + Math.round(originalCost) + '원');
          $('#paidValue').text('-      실부담금액' + cost + '원' );
          $('#buyProfit').text('+'+Math.round(profits)+'원');
        }
    </script>
</body>
</html>
